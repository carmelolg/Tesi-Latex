% !TEX encoding = UTF-8
% !TEX TS-program = pdflatex
% !TEX root = ../Tesi.tex
% !TEX spellcheck = it-IT

%************************************************
\chapter{Automi Cellulari}
\label{cap:Automi Cellulari}
%************************************************

\section{Introduzione}
Dopo decadi di sviluppo e ricerca, la scienza ricopre un ruolo
importante in ogni settore. Le pubbliche istituzioni e le aziende private
sentono il bisogno di utilizzare metodi e nuove tecniche ai fini di scoprire e
interpretare diversi casi di studio, a partire dai fenomeni naturali fino alla
statistica e all'economia. Soprattutto i fenomeni naturali, suscitano un
particolare interesse nell'ambito della ricerca scientifica, poiché dal loro
studio è possibile fornire informazioni significative sul loro comportamento
futuro e le eventuali precauzioni (nei casi di fenomeni più o meno disastrosi).

Nel 1947 da John von Neumann, con lo scopo di ideare un sistema in grado di
auto-riprodursi, introdusse gli \textbf{Automi Cellulari}. Gli Automi Cellulari
(AC) sono un insieme di regole logico-matematiche capaci di simulare
sistemi complessi. Un AC è uno spazio d-dimensionale suddiviso
in celle regolari alle quali è associato uno \textbf{stato} facente parte di un
insieme finito di stati. La \textbf{funzione di transizione} (uguale per tutto
l'insieme di celle) determina il valore dello stato di una cella in un
determinato istante $t$. Il \textbf{vicinato}, cioè una relazione
all'interno di uno spazio cellulare, influisce sullo stato di una cella. Tutto
ciò avviene in passi discreti e lo stato di tutte le celle è aggiornato in modo
simultaneo. L'insieme degli stati di tutte le celle in un determinato istante
$t$ definisce la configurazione dell' Automa Cellulare in quel preciso istante.
\begin{figure}
\centering
\subfloat[][]
{\includegraphics[width=0.22\textwidth]{immagini/spazioA}}
\subfloat[][]
{\includegraphics[width=0.22\textwidth]{immagini/spazioB}}\quad
\subfloat[][]
{\includegraphics[width=0.22\textwidth]{immagini/spazioC}}\quad
\subfloat[][]
{\includegraphics[width=0.22\textwidth]{immagini/spazioD}}\quad
\caption[Esempi di spazi cellulari]{Esempi di spazi cellulari (a)
unidimensionale, (b) e (c) bidimensionale, (d) tridimensionale.}
\label{img:spaziCellulari}
\end{figure}

\section{Definizione di Automa Cellulare}

\subsection{Definizione informale di Automa Cellulare}
\label{par:CAdefinition}
Informalmente possiamo dare una definizione di Automa Cellulare e distinguere le
proprietà fondamentali come di seguito: 
\begin{itemize}
  \item lo spazio è costituito da un insieme di celle regolari;
  \item l'insieme degli stati che possono essere assunti dalla cella è finito;
  \item l'evoluzione dell'automa avviene a passi discreti;
  \item le celle si evolvono in modo simultaneo in base ad un'unica
  legge chiamata ``funzione di transizione'';
  \item lo stato di una cella al tempo $t+1$ dipende dal suo stato
  corrente e dallo stato di tutto il suo vicinato al tempo $t$;
  \item la relazione di vicinanza è comune per tutto lo spazio cellulare e non
  cambia durante l'evoluzione dell'Automa Cellulare. Unica particolarità è
  che deve coinvolgere un numero di celle limitato.
\end{itemize}

I vicinati più utilizzati nel caso di Automi Cellulari con dimensione 2, sono
quelli di von Neumann (figura \ref{img:vicinati} a) e quello di Moore (figura
\ref{img:vicinati} b). Il primo è composto dalla cella centrale (cioè la cella
corrente) e dalle celle adiacenti a nord, sud, est, e ovest, mentre il secondo
comprende in più le celle adiacenti a nord-est, sud-est, nord-ovest e
sud-ovest formando un vero e proprio quadrato.
E' possibile comunque definire altri tipi di vicinato customizzati e non è
necessario che le celle che lo costituiscono siano strettamente adiacenti
tra di loro. 
\begin{figure}[h]
\centering
\subfloat[][\emph{Vicinato di von Neumann}]
{\includegraphics[width=0.4\textwidth]{immagini/vonNeumann}}\qquad
\subfloat[][\emph{Vicinato di Moore}]
{\includegraphics[width=0.395\textwidth]{immagini/moore}}
\caption{Esempi di relazioni di vicinanza.}
\label{img:vicinati}
\end{figure}
La funzione di transizione cambia lo stato di ogni cella in base agli stati delle
celle del vicinato.
\begin{equation}
\sigma:S_n \to S
\label{fun:transizione}
\end{equation}
La funzione \ref{fun:transizione} rappresenta in modo formale una tipica
funzione di transizione di un Automa Cellulare, dove $S$ rappresenta l'insieme
degli stati che possono essere assunti da una cella, mentre $S_n$ rappresenta
l'insieme degli stati delle $n$ celle del vicinato. Se la transizione avviene da
uno stato ad un altro allora la funzione si dice deterministica, mentre se
la transizione avviene da uno stato a un insieme di stati allora la funzione si
dice non deterministica. Nel primo caso, dato un Automa Cellulare all'istante
$t=0$, la sua configurazione all'istante successivo è unica, mentre nel secondo
caso ci possono essere diversi tipi di configurazioni diverse.


\subsection{Definizione formale di Automa Cellulare}
\label{par:ACdef}
Un Automa Cellulare può essere formalizzato come una quadrupla
\cite{DiGregorio:1975}
\begin{center}
$ < Z^d,S,X,\sigma >$
\end{center}
\begin{itemize}
  \item $Z^d$ è l'insieme delle celle facenti parte di uno spazio
  cellulare di dimensione $d$, nel quale ogni cella è un automa
  elementare. In particolare è uno spazio euclideo che fornisce le coordinate
  ad ogni cella;
  \item $S$ è un insieme finito degli stati della cella, detto \emph{spazio
  degli stati};
  \item $X$ è un insieme finito di vettori $d-$dimensionali. Esso definisce
  l'insieme dei vicini $N(X,i)$ di una generica cella
  \mbox{$i=<i_1,i_2,\ldots,i_d>$} in $Z^d$:\\
    sia $X = \{z_1,z_2,\ldots\,z_n\}$ con $n = \#X$ e $z_j =
    <x_{j1},x_{j2},\ldots ,x_{jd}>$ per $i\leq j \leq n$ allora:
    	\begin{equation}
	   		 N(X,i) = \{i+z_1,i+z_2,\ldots ,i+z_n\}
    	\end{equation}
  \item $\sigma:S^n \to S$ è la funzione di transizione elementare, cioè la
  funzione di transizione dell'automa elementare, con $n = \#X$.
\end{itemize}

Dato un automa cellulare bidimensionale una possibile configurazione può essere
la seguente:
\begin{itemize}
  \item l'insieme delle celle $Z^2=\{(i,j)|i,j\in N,m\geq0,n\geq0\}$ è una
  matrice \mbox{$n \times m$}, dove $(i,j)$ è la cella posta nella riga
  $i-$esima e nella colonna $j-$esima;
  \item lo stato della cella $(i,j)$ al tempo $t$ sara $s^t(i,j)$, essendo
  $S=\{s_1,s_2,\ldots,\\s_r\}$ l'insieme dei possibili stati della cella;
  \item $N(i,j)$ è il vicinato della cella $(i,j)$ al tempo $t$, composto dallo
  stato della cella stessa $s^t(i,j)$ e dagli stati delle celle con essa
  connesse;
  \item $\sigma(N(i,j))$ è la funzione di transizione che dà il nuovo stato
  $s^{t+1}(i,j)$ della cella $(i,j)$ al tempo $t+1$.
\end{itemize}
Data la definizione corrente di AC, definiamo i vicinati di von Neumann
e di Moore come segue:
\begin{equation*}
V_{vN}(i,j)=\{s^t(k,l) \in L | \|k-i\| + \|l-j\|\leq1\}
\end{equation*}
\begin{equation*}
V_{M}(i,j)=\{s^t(k,l) \in L | \|k-i\|\leq1, \|l-j\|\leq1\}
\end{equation*}

\section{Automi Cellulari unidimensionali}
Tra gli Automi Cellulari, quelli che suscitano particolare interesse sono gli
Automi Cellulari unidimensionali.
Gli AC unidimensionali sono costituiti da $n$ celle disposte su una griglia di
dimensioni $1 \times n$ dove la prima e l'ultima cella sono adiacenti, cioé la
griglia può essere considerata come un anello. Abbiamo $k = 2$ (ovvero 0 e 1)
stati che possono essere assunti dalla cella e il raggio del vicinato è $r=1$.
Se prendiamo in considerazione la cella $x$ il suo vicinato è formato dalla terna $ < x-r,x,x+r > $.
\begin{figure}[h]
\centering
\includegraphics[width=1\textwidth]{immagini/ACunidim}
\label{img:ACunidim}
\caption{Esempio di automa cellulare unidimensionale}
\end{figure}
Dunque nel caso degli AC unidimensionali, siccome ogni cella può assumere
$k = 2$ stati e ogni vicinato è composto da tre celle ci sono $2^3 = 8$
differenti combinazioni di vicinato e $2^8 = 256$ differenti configurazioni
dell'automa cellulare. La regola di transizione può essere espressa con una
tabella elencando in ordine crescente le configurazioni del vicinato e gli stati
delle celle centrali all'iterazione successiva (Tabella \ref{tab:uniTrans}).
\begin{table}[h]
\caption[Funzione di transizione di un AC unidimensionale]{Nella prima riga
della tabella sono elencate in ordine crescente le configurazioni dei vicinati al tempo $t_0$. Nella seconda riga sono elencati gli
stati delle celle centrali al tempo $t_1$.}
\label{tab:uniTrans}
\centering
\begin{tabular}{ccccccccc}
\midrule
$t_0$	&000	&001	&010	&011	&100	&101	&110	&111\\
$t_1$	&0		&0		&0		&0		&0		&1		&0		&1  \\
\bottomrule
\end{tabular}
\end{table}

Ad ogni configurazione dell'AC corrisponde una funzione di transizione che
determina lo stato corrente delle celle al passo $t+1$ ed è rappresentata
da una sequenza formata dagli stati delle celle stesse. Generalmente le
regole si indicano tramite numeri interi, dunque si converte la sequenza di
caratteri in un numero intero.
Nel caso dell'esempio nella tabella \ref{tab:uniTrans} la regola è definita
dalla stringa di bit $s = 00000101$ è quindi dal numero intero $n = 5$.

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{immagini/ACunidim}
\label{img:ACunidim1}
\caption[Evoluzione di un AC con regola di transizione 90]{Evoluzione di un
automa cellulare unidimensionale che ha regola di transizione 90. Ogni riga rappresenta un'iterazione dell'automa cellulare. Il
colore bianco rappresenta le celle che sono nello stato 0 mentre il colore nero quelle che
sono nello stato 1.}
\end{figure}

Secondo Wolfram \cite{Wolfram:1983} \cite{Wolfram:2002} possiamo raggruppare in
quattro classi i comportamenti differenti degli Automi Cellulari:
\begin{description}
\item[Classe 1]L'automa converge dopo poche iterazioni verso una
  configurazione uniforme indipendentemente da quale sia la configurazione
  iniziale.
\item[Classe 2]L'automa converge verso una configurazione in cui alcune
strutture si ripetono ciclicamente durante l'evoluzione dell'automa cellulare.
\item[Classe 3]L'automa si evolve con un comportamento caotico.
\item[Classe 4]L'automa si evolve con un comportamento sia caotico che ordinato.
Inoltre è costituito da strutture semplici che interagendo tra loro creano
strutture più complesse.
\end{description}

% Gli studi effettuati da Langton \cite{Langton:1990} mostrano come le classi di Wolfram sono
% collocate nello spazio delle regole e quali sono le relazioni che legano le classi tra
% loro. Per parametrizzare lo spazio delle regole, Langton ha calcolato la
% percentuale di transizioni non quiescenti, ossia le transizioni che non lasciano inalterato lo
% stato di una cella da un'iterazione all'altra.
% \begin{equation}
% \label{eqn:langton}
% \lambda = 1 - \frac{n_q}{k^n}
% \end{equation}
% La \ref{eqn:langton} mostra il parametro $\lambda$ \cite{Langton1:1990} che
% rappresenta la percentuale di transizioni non quiescenti, dove $n_q$ è il numero
% di transizioni quiescenti, mentre $k^n$ le possibili configurazioni del vicinato. Langton
% studiò il comportamento di $\lambda$ nell'intervallo tra $[0, 0.75]$ e osservò
% che per valori bassi di $\lambda$ gli AC avevano un comportamento ordinato
% tipico di quello delle classi di tipo 1 e 2, mentre per valori alti di $\lambda$
% si verificava un comportamento caotico tipico degli AC appartenenti alla classe 3.
% Infine egli osservò una terza zona vicina al valore $\lambda = 0.45$ dove gli AC
% si comportavano sia in modo ordinato che caotico producendo sia strutture statiche che
% dinamiche. Quest'ultima zona fu chiamata da Langton ``Margine del caos''.

\section{Automi Cellulari Complessi (CCA)}
\label{par:CCA}
Gli Automi Cellulari Complessi (CCA) sono un'estensione della definizione di
Automa Cellulare. Questo modello numerico si adatta perfettamente per la 
rappresentazione di fenomeni naturali in cui le dinamiche possono essere
descritte in termini di interazioni locali ad un livello macroscopico. Tra le
applicazioni degli Automi Cellulari Complessi troviamo simulazioni di flussi
lavici \cite{SCIARA:2004}, flussi di detriti \cite{SCIDDICA:1999}, incendi
\cite{FIRE:2004}, traffico stradale \cite{TRAFFIC:1996}, ecc. Estendendo la
classica definizione di CA, gli Automi Cellulari Complessi possono facilitare la
definizione di molti aspetti rilevanti per la modellazione dei sistemi
complessi. In particolare:
\begin{itemize}
  \item lo stato della cella è costituito da un insieme di sottostati. Il 
  prodotto cartesiano dei valori assunti dai sottostati definisce lo stato della cella;
  \item la funzione di transizione viene suddivisa in processi elementari;
  \item il modello viene calibrato con un insieme di parametri ``globali'' che
  permettono di variare il comportamento del fenomeno preso in considerazione;
  \item un sottoinsieme di celle è soggetto anche ad influenze esterne. Lo stato
  della cella, oltre a dipendere dalla funzione di transizione e dallo stato
  delle celle del vicinato, dipende anche da un'altra funzione che rappresenta
  fenomeni esterni all'Automa Cellulare.
\end{itemize}
Più formalmente un CCA è rappresentato da una 7-tupla:
\begin{equation*}
<Z^d,X,Q,P,\sigma,G,\gamma>
\end{equation*}
Dove $Z^d$, $X$ e $\sigma$ hanno lo stesso significato che hanno per gli AC
classici (vedo paragrafo \ref{par:ACdef}) e
\begin{itemize}
  \item $Q = Q_{s1} \times Q_{s2} \times \ldots \times Q_{sn}$ è l'insieme dei
  sottostati della cella;
  \item $P = p_1, p_2, \ldots, p_p$ è l'insieme dei parametri globali usati per
  calibrare il modello;
  \item $G = G_1 \cup G_2 \cup \ldots \cup G_l \subseteq Z^d$ è il sottoinsieme
  di celle di $Z^d$ soggette ad influenza esterna.
  \item $\gamma = \{\gamma_1, \gamma_2,\ldots,\gamma_t\}$ è l'insieme di
  funzioni che definiscono le influenze esterne
\end{itemize}

\section{SCIARA-fv2}
\label{par:sciarafv2}

SCIARA è un modello computazionale basato su Automi Cellulari Complessi (CCA,
\ref{par:CCA}) che simula il fenomeno naturale di una colata lavica. Già da
qualche anno è utilizzato per numerose simulazioni di casi realmente
accaduti, tra i più famosi l'eruzione del Monte Etna nell'area di Nicolosi del
2001 \cite{SCIARA:2004} e nell'area di Valle del Bove nel 1991
\cite{SCIARA:2001}. 
Possiamo formalizzare l'automa cellulare complesso che definisce SCIARA nel
seguente modo:

\begin{equation*}
SCIARA = <Z^d, S, X, G, P, \tau, \gamma> 
\end{equation*}

\begin{itemize}
  \item $Z^d$ è uno spazio bi-dimensionale;
  \item $S = S_z \times S_h \times S_t \times S^8_f$ è l'insieme finito degli
  stati che può assumere una cella ottenuto dal prodotto cartesiano dei
  sottostati. Il loro significato è rispettivamente: quota (altitudine) della
  cella, spessore della lava, temperatura della lava, flussi uscenti dalla cella centrale verso
  le celle del vicinato (Nord, Ovest, Est, Sud, Nord-Ovest, Sud-Ovest, Sud-Est,
  Nord-Est);
  \item $X$ è la relazione di vicinanza di Moore;
  \item $P$ è l'insieme dei parametri globali usati per calibrare il modello. In
  particolare questi parametri non variano nel tempo;
  \item $\tau : S^9 \to S$ è la funzione di transizione deterministica,
  probabilistica o mista dell'automa;
  \item $\gamma : S_h \times  \mathbb{N} \to S_h$ è la funzione che rappresenta
  le influenze esterne e in particolare l'emissione della lava dalle celle
  sorgenti.
\end{itemize}
La funzione di transizione di SCIARA è composta da quattro processi elementari:
\begin{itemize}
  \item {\bfseries calcolo dei flussi uscenti}: determina la fuoriuscita di lava dalla
  cella centrale verso le celle del vicinato applicando l'algoritmo di minimizzazione
  delle differenze.
  \item {\bfseries calcolo della quantità di lava}: determina la quantità di
  lava considerando i flussi uscenti dalle celle.
  \item {\bfseries calcolo della temperatura}: determina la temperatura della
  lava considerando la temperatura dei flussi entranti e la perdita di energia
  termica dalla superficie.
  \item {\bfseries solidificazione}: determina la solidificazione della lava
  quando la temperatura scende al di sotto di un determinato valore. 
\end{itemize}

\begin{figure}[h]
\centering
\includegraphics[width=0.4\textwidth]{immagini/real}
\label{fig:realevent}
\caption[Colata lavica del 2006 del Monte Etna]{Evento reale disegnato dal
software Qgis} 
\end{figure}

Parte di questo lavoro di tesi è stato parallelizzare questo modello utilizzando
la libreria OpenCAL-CUDA che verrà descritta nel capitolo \ref{cap:OpenCAL-CUDA}.

Nella figura è mostrata la simulazione della colata lavica datata
2006.


